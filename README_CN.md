# Claude Code 重构代理工具集

一套完整的AI代理工具，专为在Claude Code环境中系统化地分析、规划、执行和报告代码重构任务而设计。

## 🎯 项目背景

当使用Claude Code进行大规模软件开发时，项目往往面临架构复杂性快速增长的问题。常见问题包括：

- **代码重复**：相似逻辑分散在多个文件中
- **巨型文件**：单体文件难以维护
- **功能分散**：相关功能散布在不同模块中
- **文件类型混乱**：测试文件、文档和源代码混杂
- **AI生成的临时文件**：需要整合的小测试和文档文件

这些问题随着时间推移不断积累，使代码库变得越来越难以维护和扩展。

## 🚀 解决方案概览

本项目提供**4阶段结构化**的代码重构方法，使用专门的Claude Code代理：

### 第一阶段：评估（判断代理）
- 使用定量指标分析代码库健康状况
- 识别代码异味和架构问题
- 提供5级推荐系统：
  - **强烈建议** - 需要立即处理的关键问题
  - **高度建议** - 影响可维护性的重要问题
  - **建议** - 值得处理的中等问题
  - **可以等待** - 可以推迟的轻微问题
  - **无需处理** - 代码库状况良好

### 第二阶段：规划（规划代理）  
- 基于评估结果制定详细的重构策略
- 确保重构前有全面的测试覆盖
- 规划包含安全检查点的分步执行计划
- 优先保持整个过程中的功能一致性

### 第三阶段：执行（执行代理）
- 严格按照策略实施重构计划
- 在每个修改步骤后运行自动测试
- 通过持续验证维护系统稳定性
- 如果任何测试失败立即停止

### 第四阶段：报告（报告代理）
- 生成全面的前后对比分析
- 量化代码指标的改进
- 记录整合的文件和移除的重复代码
- 为未来开发提供可行的见解

## 📁 仓库结构

```
CCRefactorAgents/
├── README.md                 # 英文版说明文档
├── README_CN.md             # 中文版说明文档（本文件）
├── judgment-agent.md        # 第一阶段：代码健康评估代理
├── planning-agent.md        # 第二阶段：重构策略规划代理  
├── execution-agent.md       # 第三阶段：安全重构执行代理
└── reporting-agent.md       # 第四阶段：结果分析和报告代理
```

## ⚙️ 配置说明

### 方案一：使用Claude Code的`/agents`命令（推荐）

1. **在Claude Code中添加代理**：
   ```bash
   /agents
   ```

2. **手动配置各个代理**：
   - 选择"手动配置"
   - 从相应的`.md`文件复制内容：
     - `judgment-agent.md` 用于评估
     - `planning-agent.md` 用于规划
     - `execution-agent.md` 用于执行
     - `reporting-agent.md` 用于报告
   - 粘贴到系统提示字段
   - **工具选择**：选择**所有可用工具**以获得最大效果

### 方案二：模型选择建议

#### 追求最佳效果：
- **评估与规划**：使用**Claude Opus**进行深度分析和战略思考
- **执行与报告**：使用**Claude Sonnet**高效实施和生成文档

#### 考虑成本效益：
- **所有阶段**：使用**Claude Sonnet**获得平衡的性能和成本
- **替代方案**：使用**Gemini CLI**进行评估和规划阶段

### 方案三：直接集成

在需要时直接将代理提示复制到Claude Code会话中：

```bash
# 评估阶段 - 粘贴 judgment-agent.md 内容
# 规划阶段 - 粘贴 planning-agent.md 内容  
# 执行阶段 - 粘贴 execution-agent.md 内容
# 报告阶段 - 粘贴 reporting-agent.md 内容
```

## 🛠 使用说明

每个代理都设计为在Claude Code中按顺序使用：

### 1. 评估阶段
```bash
# 使用 judgment-agent.md 提示分析你的代码库
# 输入：整个代码库
# 输出：健康评估和5级推荐
```

### 2. 规划阶段  
```bash
# 如果推荐重构，使用 planning-agent.md 提示
# 输入：评估报告 + 代码库
# 输出：详细的重构计划和测试需求
```

### 3. 执行阶段
```bash
# 计划批准后，使用 execution-agent.md 提示
# 输入：重构计划 + 代码库 + 测试运行器
# 输出：逐步执行和测试验证
```

### 4. 报告阶段
```bash
# 成功执行后，使用 reporting-agent.md 提示
# 输入：重构前后代码库快照 + 初始评估
# 输出：量化改进报告
```

## 🔧 核心特性

- **安全优先方法**：每个重构步骤都包含测试验证
- **量化分析**：基于具体指标的数据驱动决策
- **增量进步**：小而可验证的步骤防止系统破坏
- **全面文档**：清晰的规划和报告确保问责
- **Claude Code优化**：专为Claude Code工作流程设计

## 📊 跟踪的指标

代理监控并改进：
- 代码重复百分比
- 平均文件长度
- 函数复杂度
- 模块内聚性
- 测试覆盖率
- 文档整合
- 文件组织

## 🤝 贡献

这是一个开源项目。欢迎通过以下方式贡献：
- 错误报告和功能请求
- 代理提示改进
- 额外的指标和分析能力
- 文档增强

## 📄 许可证

MIT许可证 - 欢迎在你的项目中自由使用、修改和分发这些代理。

## 🏗 架构

每个代理都遵循结构化的提示格式：
- **角色定义**：明确的代理职责
- **任务上下文**：背景和目标
- **输入/输出规范**：定义的数据格式
- **规则和约束**：安全和质量指南
- **分步思考**：逻辑处理流程
- **示例交互**：使用演示

这种系统化方法确保在不同代码库和项目类型中获得一致、可靠的重构结果。

## 💡 使用技巧

1. **建议按阶段使用**：不要跳过任何阶段，每个阶段都有其重要作用
2. **保存中间结果**：每个阶段的输出都应该保存，便于后续参考
3. **测试是关键**：特别注意测试覆盖率，这是安全重构的基础
4. **小步快跑**：不要试图一次性进行大规模重构
5. **定期评估**：在大型项目中，建议定期运行评估代理

## 🔍 常见问题

**Q: 我的项目很小，是否需要使用所有代理？**
A: 对于小项目，可以从判断代理开始，如果评估结果是"无需处理"或"可以等待"，则可以暂时跳过其他阶段。

**Q: 可以在现有项目中使用吗？**
A: 是的，这些代理专门设计用于分析和重构现有代码库。

**Q: 如何处理重构过程中的冲突？**
A: 执行代理会在每步后运行测试，如果发现问题会立即停止。你可以手动解决冲突后继续。

**Q: 支持哪些编程语言？**
A: 代理设计为语言无关的，支持所有主流编程语言。